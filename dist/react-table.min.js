/*! react-table 03-11-2014 Author: Erfang Chen */
function buildLAFConfigObject(a){var b=a.formatInstructions,c={multiplier:1,roundTo:2,unit:null,alignment:getColumnAlignment(a)};if(!b)return c;for(var d=b.split(/\s+/),e=0;e<d.length;e++){var f=d[e].split(":",2)[0];c[f]=d[e].split(":",2)[1]}return c}function buildCellLookAndFeel(a,b){"use strict";var c={classes:{},styles:{},value:{}},d=b[a.colTag];a.formatConfig=buildLAFConfigObject(a);var e=a.formatConfig;return a.cellClassCallback&&(c.classes=a.cellClassCallback(b)),d=formatNumber(d,a,e),e.unit&&(d=d+" "+e.unit),"currency"==a.format&&(d="$"+d),c.styles.textAlign=e.alignment,c.styles.width=a.text.length+"em",c.value=d,c}function getColumnAlignment(a){"use strict";return"number"==a.format||"currency"==a.format?"right":"left"}function formatNumber(a,b,c){return isNaN(a)||"number"!=b.format&&"currency"!=b.format||(a*=c.multiplier,a=a.toFixed(c.roundTo)),a}function groupData(a,b,c){var d=buildDataBuckets(a,b),e=aggregateBuckets(d,c);return e.concat(a)}function straightSumAggregation(a){for(var b=a.data,c=a.columnDef,d=0,e=0,f=0;f<b.length;f++)e=b[f][c.colTag]||0,d+=e;return d}function average(a){return a.columnDef.weightBy?weightedAverage(a):simpleAverage(a)}function simpleAverage(a){return straightSumAggregation(a)/a.data.length}function weightedAverage(a){for(var b=a.data,c=a.columnDef,d=a.columnDef.weightBy,e=0,f=0;f<b.length;f++)e+=(b[f][c.colTag]||0)*(b[f][d.colTag]||0);var g=straightSumAggregation({data:b,columnDef:d});return e/g}function count(a){a.data,a.columnDef}function countDistinct(a){a.data,a.columnDef}function extractSectors(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a[b[d].colTag]);return c}function buildDataBuckets(a,b){for(var c={},d=0;d<a.length;d++){var e=extractSectors(a[d],b);a[d].sectorPath=e,a[d].isDetail=!0;for(var f=0;f<e.length;f++){var g=e.slice(0,f+1),h=generateSectorKey(g);c[h]||(c[h]={data:[],sectorPath:g}),c[h].data.push(a[d])}}return c}function aggregateBuckets(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=aggregateSector(a[d],b);c.push(e)}return c}function aggregateSector(a,b){var c={};c.sectorPath=a.sectorPath,c[b[0].colTag]=a.sectorPath[a.sectorPath.length-1];for(var d=1;d<b.length;d++)c[b[d].colTag]=aggregateColumn(a,b[d]);return c}function aggregateColumn(a,b){var c;switch(b.aggregationMethod){case"SUM":c=straightSumAggregation({data:a.data,columnDef:b});break;case"AVERAGE":c=average({data:a.data,columnDef:b});break;default:c=""}return c}function buildHeaders(a){var b=a.state.columnDefs[0],c=1,d={},e={},f=React.createElement("div",{style:{textAlign:"left"},className:"rt-header-element",key:b.colTag},React.createElement("a",{className:"btn-link"},b.text),React.createElement("div",{style:{left:"0%"},className:"rt-header-menu"},React.createElement("div",{onClick:a.handleSort.bind(a,b,!0)},"Sort Asc"),React.createElement("div",{onClick:a.handleSort.bind(a,b,!1)},"Sort Dsc"),React.createElement("div",{onClick:a.handleGroupBy.bind(a,b)},"Summarize"),React.createElement("div",{onClick:a.handleGroupBy.bind(a,null)},"Un-Summarize"))),g=[f];for(c=1;c<a.state.columnDefs.length;c++)b=a.state.columnDefs[c],d={textAlign:getColumnAlignment(b)},e={},"right"==d.textAlign?e.right="0%":e.left="0%",g.push(React.createElement("div",{style:d,className:"rt-header-element",key:b.colTag},React.createElement("a",{className:"btn-link"},b.text),React.createElement("div",{style:e,className:"rt-header-menu"},React.createElement("div",{onClick:a.handleSort.bind(a,b,!0)},"Sort Asc"),React.createElement("div",{onClick:a.handleSort.bind(a,b,!1)},"Sort Dsc"),React.createElement("div",{onClick:a.handleGroupBy.bind(a,b)},"Summarize"),React.createElement("div",{onClick:a.handleRemove.bind(a,b)},"Remove Column"))));return g.push(React.createElement("span",{className:"rt-header-element rt-add-column",style:{textAlign:"center"}},React.createElement("a",{className:"btn-link",onClick:a.handleAdd},React.createElement("strong",null,"+")))),React.createElement("div",{key:"header",className:"rt-headers"},g)}function buildFirstCellForRow(a){var b=a.data,c=a.columnDefs[0],d=a.toggleHide,e=c.colTag;if(!b.sectorPath)return React.createElement("td",{key:e},b[e]);var f=b.isDetail?b.sectorPath.length:b.sectorPath.length-1,g={paddingLeft:10+25*f+"px",borderRight:"1px #ddd solid"};if(b.isDetail)var h=React.createElement("td",{style:g,key:e},b[e]);else h=React.createElement("td",{style:g,key:e},React.createElement("a",{onClick:d.bind(null,b),className:"btn-link"},React.createElement("strong",null,b[e])));return h}function buildFooter(a,b){return a.props.columnDefs.length>0?React.createElement(PageNavigator,{items:b.allPages.slice(b.pageDisplayRange.start,b.pageDisplayRange.end),activeItem:a.state.currentPage,numPages:b.pageEnd,handleClick:a.handlePageClick}):null}function getPageArithmetics(a,b){var c={};c.pageSize=a.props.pageSize||50,c.maxDisplayedPages=a.props.maxDisplayedPages||10,c.pageStart=1,c.pageEnd=Math.ceil(b.length/c.pageSize),c.allPages=[];for(var d=c.pageStart;d<=c.pageEnd;d++)c.allPages.push(d);return c.pageDisplayRange=computePageDisplayRange(a.state.currentPage,c.maxDisplayedPages),c.lowerVisualBound=(a.state.currentPage-1)*c.pageSize,c.upperVisualBound=Math.min(a.state.currentPage*c.pageSize-1,b.length),c}function shouldHide(a,b,c){var d=!1,e=areAncestorsCollapsed(a.sectorPath,b,c),f=!a.isDetail,g=null!=b[generateSectorKey(a.sectorPath)];return e?d=!0:g&&!f&&(d=!0),d}function areAncestorsCollapsed(a,b,c){for(var d=!1,e=c.length,f=0;e>f;f++)isSubSectorOf(a,b[c[f]])&&(d=!0);return d}function isSubSectorOf(a,b){if(a.length<=b.length)return!1;for(var c=0;c<b.length;c++)if(a[c]!=b[c])return!1;return!0}function sectorPathMatchesExactly(a,b){"use strict";var c=!0,d=0,e=a.length;if(a.length!=b.length)c=!1;else for(d=0;e>d;d++)a[d]!=b[d]&&(c=!1);return c}function generateRowKey(a,b){var c;if(a.isDetail)if(b)c=a[b];else{c=generateSectorKey(a.sectorPath);for(var d in a)a.hasOwnProperty(d)&&(c+=d+"="+a[d]+";")}else c=generateSectorKey(a.sectorPath);return c}function generateSectorKey(a){return a?a.join(SECTOR_SEPARATOR):""}function prepareTableData(a){var b=deepCopyData(a.data);if(a.groupBy){b=groupData(b,a.groupBy,a.columnDefs);var c={sectorSorter:defaultSectorSorter,detailSorter:defaultDetailSorter};b.sort(sorterFactory.call(this,c))}return b}function deepCopyData(a){return a.map(function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b.isDetail=!0,b})}function getInitiallyCollapsedSectorPaths(a){var b={};return a.map(function(a){if(a.sectorPath&&a.isDetail){var c=generateSectorKey(a.sectorPath);b[c]||(b[c]=a.sectorPath)}}),b}function computePageDisplayRange(a,b){var c=b,d=Math.min(Math.floor(c/2),a-1),e=c-d;return{start:a-d-1,end:a+e-1}}function adjustHeaders(){var a=this.state.uniqueId,b=0,c=$("#"+a+" .rt-header-element"),d=parseInt(c.first().css("padding-left"))||0;d+=parseInt(c.first().css("padding-right"))||0,c.each(function(){var c=$("#"+a+" .rt-table tr:first td:eq("+b+")").outerWidth()-d;$(this).width(c),b++})}function uniqueId(a){var b=++idCounter+"";return a?a+b:b}function ReactTableGetInitialState(){var a=prepareTableData.call(this,this.props),b=getInitiallyCollapsedSectorPaths(a),c=[];for(var d in b)b.hasOwnProperty(d)&&c.push(d);var e=getInitiallySelectedRows(this.props.selectedRows);return{uniqueId:uniqueId("table"),currentPage:1,height:this.props.height,data:a,columnDefs:this.props.columnDefs,collapsedSectorPaths:b,collapsedSectorKeys:c,selectedRows:e}}function ReactTableHandleSort(a,b){var c=this.state.data,d={sectorSorter:defaultSectorSorter,detailSorter:getSortFunction(a),sortDetailBy:a,sortAsc:b};c.sort(sorterFactory.call(this,d)),this.setState({data:c,sorting:a})}function ReacTableHandleGroupBy(a){var b=this.props;b.groupBy=a?[a]:null;var c=prepareTableData.call(this,b),d=getInitiallyCollapsedSectorPaths(c),e=[];for(var f in d)d.hasOwnProperty(f)&&e.push(f);this.setState({data:c,collapsedSectorPaths:d,collapsedSectorKeys:e})}function ReactTableHandleAdd(){this.props.beforeColumnAdd&&this.props.beforeColumnAdd()}function ReactTableHandleRemove(a){for(var b=this.state.columnDefs.indexOf(a),c=[],d=0;d<this.state.columnDefs.length;d++)d!=b&&c.push(this.state.columnDefs[d]);this.setState({columnDefs:c}),null!=this.props.afterColumnRemove&&this.props.afterColumnRemove(c,a)}function ReactTableHandleToggleHide(a,b){b.stopPropagation();var c=generateSectorKey(a.sectorPath);null==this.state.collapsedSectorPaths[c]?(this.state.collapsedSectorPaths[c]=a.sectorPath,this.state.collapsedSectorKeys.push(c)):(delete this.state.collapsedSectorPaths[c],this.state.collapsedSectorKeys.splice(this.state.collapsedSectorKeys.indexOf(c),1)),this.setState({collapsedSectorPaths:this.state.collapsedSectorPaths,collapsedSectorKeys:this.state.collapsedSectorKeys})}function ReactTableHandlePageClick(a,b){b.preventDefault();var c=this.props.pageSize||10,d=Math.ceil(this.state.data.length/c);1>a||a>d||this.setState({currentPage:a})}function ReactHandleRowSelect(a){"use strict";var b=null,c=null,d=!1,e=null;a.isDetail?(b="detailRows",c=generateRowKey(a,this.props.rowKey),e=processDetailRowSelect):(b="summaryRows",c=generateSectorKey(a.sectorPath),e=processSummaryRowSelect),isRowSelected.call(this,a)?delete this.state.selectedRows[b][c]:(this.state.selectedRows[b][c]=1,d=!0),e.call(this,a,d),this.setState({selectedRows:this.state.selectedRows})}function processSummaryRowSelect(a,b){"use strict";var c={detailRows:[],summaryRow:a},d=0,e=this.state.data.length,f=null;for(d=0;e>d;d++)f=this.state.data[d],f.isDetail&&(isSubSectorOf(f.sectorPath,a.sectorPath)||sectorPathMatchesExactly(f.sectorPath,a.sectorPath))&&c.detailRows.push(f);this.props.onSummarySelectCallback&&this.props.onSummarySelectCallback.call(this,c,b)}function processDetailRowSelect(a,b){"use strict";var c=this.props.rowKey;c&&this.props.onSelectCallback&&this.props.onSelectCallback.call(this,a,b)}function getInitiallySelectedRows(a){var b={detailRows:{},summaryRows:{}};a=a||[];for(var c=0;c<a.length;c++)b.detailRows[a[c]]=1;return b}function isRowSelected(a){var b=!1,c=null,d=null;return a.isDetail?(d=generateRowKey(a,this.props.rowKey),b=null!=this.state.selectedRows.detailRows[d]):(c=generateSectorKey(a.sectorPath),b=null!=this.state.selectedRows.summaryRows[c]),b}function sorterFactory(a){var b=a.sectorSorter,c=a.detailSorter,d=a.sortSummaryBy,e=a.sortDetailBy;return sortAsc=a.sortAsc,function(a,f){var g=0;return g=b.call(d,a,f),0==g&&(g=a.isDetail&&!f.isDetail?1:f.isDetail&&!a.isDetail?-1:0,0==g&&(g=c.call(e,a,f),sortAsc||(g*=-1))),g}.bind(this)}function defaultSectorSorter(a,b){return generateSectorKey(a.sectorPath).localeCompare(generateSectorKey(b.sectorPath))}function defaultDetailSorter(a,b){return generateRowKey(a).localeCompare(generateRowKey(b))}function genericDetailSort(a,b){var c=0;return a[this.colTag]<b[this.colTag]?c=-1:a[this.colTag]>b[this.colTag]&&(c=1),this.asc&&(c*=-1),c}function dateDetailSort(a,b){var c=new Date(a[this.colTag])-new Date(b[this.colTag]);return this.asc&&(c*=-1),c}function getSortFunction(a){var b=a.format||"";if(a.sort)return a.sort;switch(b){case"date":return dateDetailSort;default:return genericDetailSort}}var SECTOR_SEPARATOR="#",ReactTable=React.createClass({displayName:"ReactTable",getInitialState:ReactTableGetInitialState,handleSort:ReactTableHandleSort,handleAdd:ReactTableHandleAdd,handleRemove:ReactTableHandleRemove,handleToggleHide:ReactTableHandleToggleHide,handleGroupBy:ReacTableHandleGroupBy,handlePageClick:ReactTableHandlePageClick,handleRowSelect:ReactHandleRowSelect,addColumn:function(a,b){this.state.columnDefs.push(a),this.setState({columnDefs:this.state.columnDefs}),b&&this.setState({data:b})},componentDidMount:function(){adjustHeaders.call(this),window.addEventListener("resize",adjustHeaders.bind(this))},componentWillUnmount:function(){window.removeEventListener("resize",adjustHeaders.bind(this))},componentDidUpdate:adjustHeaders,render:function(){for(var a=[],b=0;b<this.state.data.length;b++){var c=this.state.data[b];shouldHide(c,this.state.collapsedSectorPaths,this.state.collapsedSectorKeys)||a.push(c)}var d=getPageArithmetics(this,a),e=a.slice(d.lowerVisualBound,d.upperVisualBound+1),f=e.map(function(a){var b=this.props.rowKey;return React.createElement(Row,{data:a,key:generateRowKey(a,b),isSelected:isRowSelected.call(this,a),onSelect:this.handleRowSelect,columnDefs:this.state.columnDefs,toggleHide:this.handleToggleHide})},this),g=buildHeaders(this),h=buildFooter(this,d),i={};return this.state.height&&parseInt(this.state.height)>0&&(i.height=this.state.height),React.createElement("div",{id:this.state.uniqueId,className:"rt-table-container"},g,React.createElement("div",{style:i,className:"rt-scrollable"},React.createElement("table",{className:"rt-table"},React.createElement("tbody",null,f))),h)}}),Row=React.createClass({displayName:"Row",render:function(){for(var a=[buildFirstCellForRow(this.props)],b=1;b<this.props.columnDefs.length;b++){var c=this.props.columnDefs[b],d=buildCellLookAndFeel(c,this.props.data),e=React.addons.classSet,f=e(d.classes);a.push(React.createElement("td",{className:f,style:d.styles,key:c.colTag},d.value))}var e=React.addons.classSet,f=e({selected:this.props.isSelected&&this.props.data.isDetail,"summary-selected":this.props.isSelected&&!this.props.data.isDetail}),g={cursor:this.props.data.isDetail?"pointer":"inherit"};return React.createElement("tr",{onClick:this.props.onSelect.bind(null,this.props.data),className:f,style:g},a)}}),PageNavigator=React.createClass({displayName:"PageNavigator",render:function(){var a=this,b=React.addons.classSet,c=b({disabled:1==this.props.activeItem}),d=b({disabled:this.props.activeItem==this.props.numPages}),e=this.props.items.map(function(b){return React.createElement("li",{key:b,className:a.props.activeItem==b?"active":""},React.createElement("a",{href:"#",onClick:a.props.handleClick.bind(null,b)},b))});return React.createElement("ul",{className:c,className:"pagination pull-right"},React.createElement("li",{className:d},React.createElement("a",{className:c,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem-1)},"«")),e,React.createElement("li",{className:d},React.createElement("a",{className:d,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem+1)},"»")))}});$(document).ready(function(){$(".rt-scrollable").bind("scroll",function(){$(".rt-headers").scrollLeft($(this).scrollLeft())})});var idCounter=0;